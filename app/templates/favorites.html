{% extends "base.html" %}
{% block title %}Favorites{% endblock %}
{% block content %}
<style>
  .rename-form {
    margin: 0;
  }
  .rename-input {
    border: 1px solid transparent;
    background: transparent;
    padding: 2px 6px;
    border-radius: 6px;
    font-size: 1.4rem;
    font-weight: 600;
    min-width: 180px;
  }
  .rename-input:hover,
  .rename-input:focus {
    border-color: #d1d5db;
    background: #f8fafc;
    outline: none;
  }
  .rename-hint {
    opacity: 0;
    transition: opacity 0.12s ease;
  }
  .rename-form:hover .rename-hint,
  .rename-input:focus + .rename-hint {
    opacity: 1;
  }
</style>
<div class="row g-4">
  <div class="col-lg-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="text-muted">Folders</h6>
        {% if favorites %}
          <div class="list-group mb-3">
            {% for fav in favorites %}
              <a class="list-group-item list-group-item-action {% if selected and fav['id'] == selected['id'] %}active{% endif %}"
                 href="{{ url_for('feed.favorites', favorite_id=fav['id']) }}">
                {{ fav['name'] }}
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted small">No favorites yet.</p>
        {% endif %}
        <form method="post" action="{{ url_for('feed.create_favorite') }}">
          <div class="mb-2">
            <label for="favName" class="form-label">New folder</label>
            <input class="form-control" id="favName" name="name" placeholder="e.g. RL papers">
          </div>
          <input type="hidden" name="return_to" value="{{ request.path }}">
          <button class="btn btn-primary w-100" type="submit">Create</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-9">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        {% if selected %}
          <form class="rename-form d-flex align-items-center gap-2" method="post" action="{{ url_for('feed.rename_favorite', favorite_id=selected['id']) }}">
            <input class="rename-input" type="text" name="name" value="{{ selected['name'] }}" title="Click to edit name, press Enter to save">
            <span class="rename-hint text-muted small">Enter 保存</span>
          </form>
          <p class="text-muted small mb-0">ID: {{ selected['id'] }}</p>
          <form class="mt-2" method="post" action="{{ url_for('feed.delete_favorite', favorite_id=selected['id']) }}" onsubmit="return confirm('Delete this folder and its saved papers links?');">
            <button class="btn btn-sm btn-outline-danger" type="submit">Delete folder</button>
          </form>
        {% else %}
          <h1 class="h4 mb-0">Favorites</h1>
        {% endif %}
      </div>
    </div>
    {% if not papers %}
      <div class="alert alert-info shadow-sm">No papers stored in this folder.</div>
    {% else %}
      <div class="row g-4">
        {% for paper in papers %}
        <div class="col-12 col-md-6">
          <div class="card h-100 shadow-sm border-0">
            {% if paper.image_url %}
              <img src="{{ paper.image_url }}" class="card-img-top" alt="Thumbnail">
            {% endif %}
            <div class="card-body d-flex flex-column">
              <p class="text-muted small mb-1">{{ paper.category or 'Unknown' }}</p>
              <h2 class="h6 mb-1">{{ paper.title_zh or paper.title_en }}</h2>
              <p class="text-muted small mb-2">{{ paper.title_en }}</p>
              <p class="mb-2">{{ paper.summary_zh or paper.summary_en or paper.abstract_zh or paper.abstract_en[:140] ~ '…' }}</p>
              <div class="mb-2">
                {% for tag in paper.tags %}
                  <span class="badge rounded-pill text-bg-light border me-1">{{ tag }}</span>
                {% endfor %}
              </div>
              <div class="mt-auto d-flex justify-content-between align-items-center">
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('feed.paper_detail', paper_id=paper.id) }}">Details</a>
                <form method="post" action="{{ url_for('feed.remove_from_favorite', favorite_id=selected['id']) }}">
                  <input type="hidden" name="paper_id" value="{{ paper.id }}">
                  <button class="btn btn-sm btn-link text-danger" type="submit">Remove</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
